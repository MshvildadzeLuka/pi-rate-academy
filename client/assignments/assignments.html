<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>დავალებები | Pi-Rate Academy</title>
    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/header/header.css">
    <link rel="stylesheet" href="/assignments/assignments.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div id="header-placeholder"></div>

    <main class="assignments-container">
        <div class="assignments-main-header">
            <h1>დავალებები</h1>
            <div class="header-actions" id="teacher-admin-controls" style="display: none;">
                <div class="form-group">
                    <select id="group-select" aria-label="აირჩიეთ ჯგუფი"></select>
                </div>
                <button id="create-assignment-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> დავალების შექმნა
                </button>
            </div>
        </div>

        <nav class="tabs-nav" id="tabs-nav">
            <!-- Tabs will be dynamically generated -->
        </nav>

        <div class="content-area">
            <div id="assignment-list-view" class="view active">
                <!-- Assignment list will be dynamically generated -->
            </div>

            <div id="assignment-detail-view" class="view">
                <!-- Assignment detail view will be dynamically generated -->
            </div>
        </div>
    </main>

    <div id="modal-backdrop" class="modal-backdrop" style="display: none;">
        <!-- Modals will be dynamically generated -->
    </div>

    <!-- Templates -->
    <template id="template-create-assignment-modal">
        <div class="modal" id="create-assignment-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-header">
                <h2 id="modal-title">დავალების შექმნა</h2>
                <button class="close-modal-btn" data-action="close-modal" aria-label="მოდალის დახურვა">&times;</button>
            </div>
            <form id="assignment-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="assignment-title">სათაური</label>
                        <input type="text" id="assignment-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="assignment-instructions">ინსტრუქციები</label>
                        <textarea id="assignment-instructions" name="instructions" rows="5"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assignment-points">ქულები</label>
                            <input type="number" id="assignment-points" name="points" value="100" min="0">
                        </div>
                        <div class="form-group">
                            <label for="assignment-course">ჯგუფ(ებ)ი</label>
                            <select id="assignment-course" name="courseId" required multiple></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assignment-start-time">დაწყების დრო</label>
                            <input type="datetime-local" id="assignment-start-time" name="startTime" required>
                        </div>
                        <div class="form-group">
                            <label for="assignment-end-time">დასრულების დრო</label>
                            <input type="datetime-local" id="assignment-end-time" name="endTime" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>მიმაგრებული ფაილები</label>
                        <div class="file-uploader" id="attachment-drop-zone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>გადაათრიეთ ფაილები აქ ან დააჭირეთ ფაილების მოსაძიებლად</p>
                            <input type="file" id="attachment-file-input" multiple hidden>
                        </div>
                        <div class="file-list" id="attachment-list"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">გაუქმება</button>
                    <button type="submit" class="btn btn-primary">დავალების შენახვა</button>
                </div>
            </form>
        </div>
    </template>

    <template id="template-file-item">
        <div class="file-list-item">
            <i class="fas file-icon"></i>
            <div class="file-info">
                <span class="file-name"></span>
                <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="file-status"></div>
            <button type="button" class="remove-file-btn" data-action="remove-file" aria-label="ფაილის წაშლა">&times;</button>
        </div>
    </template>

    <template id="template-student-detail-view">
        <div class="detail-panel">
            <div class="detail-panel-header">
                <button class="btn back-btn" data-action="back-to-list" aria-label="დავალებების სიაზე დაბრუნება"><i class="fas fa-arrow-left"></i> უკან</button>
            </div>
            <div class="detail-content">
                <div class="assignment-main-content">
                    <h2 class="assignment-title-detail"></h2>
                    <div class="assignment-meta-detail">
                        <span>ვადა: <strong class="due-date"></strong></span>
                        <span>ქულები: <strong class="points"></strong></span>
                    </div>
                    <div class="instructions-container">
                        <h3>ინსტრუქციები</h3>
                        <div class="instructions-text"></div>
                    </div>
                    <div class="attachments-container">
                        <h3>მასწავლებლის მიმაგრებული ფაილები</h3>
                        <div class="attachments-list"></div>
                    </div>
                    <div class="feedback-container" style="display: none;">
                        <h3>გამოკვლევა</h3>
                        <div class="feedback-box"></div>
                    </div>
                </div>
                <div class="submission-sidebar">
                    <div class="submission-box">
                        <h3>ჩემი სამუშაო</h3>
                        <div class="submission-status-box">
                            <span class="status-badge"></span>
                        </div>
                        <div class="file-list" id="submission-file-list"></div>
                        <div class="submission-actions">
                            <div class="file-uploader" id="submission-drop-zone" data-action="trigger-file-upload" data-target="submission-file-input">
                                <i class="fas fa-paperclip"></i>
                                <p>ფაილის დამატება</p>
                            </div>
                            <input type="file" id="submission-file-input" multiple hidden>
                            
                            <button class="btn btn-primary hand-in-btn" data-action="submit-assignment" disabled>გაგზავნა</button>
                            <button class="btn btn-secondary unsubmit-btn" data-action="unsubmit-assignment" style="display: none;">გაგზავნის გაუქმება</button>
                            <button class="btn btn-secondary request-retake-btn" data-action="request-retake" style="display: none;">ხელახლა შესრულების მოთხოვნა</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="template-teacher-detail-view">
         <div class="detail-panel-grading">
            <div class="detail-panel-header">
                 <button class="btn back-btn" data-action="back-to-list" aria-label="დავალებების სიაზე დაბრუნება"><i class="fas fa-arrow-left"></i> სიაზე დაბრუნება</button>
                 <h2 class="assignment-title-detail"></h2>
                 <button class="btn btn-secondary edit-master-btn" data-action="edit-assignment" aria-label="დავალების რედაქტირება"><i class="fas fa-edit"></i> რედაქტირება</button>
                 <button class="btn btn-danger" data-action="delete-assignment" aria-label="დავალების წაშლა"><i class="fas fa-trash"></i> წაშლა</button>
            </div>
            <div class="grading-layout">
                <div class="student-list-sidebar"></div>
                <div class="grading-main-content">
                    <div class="grading-view-placeholder">
                        <i class="fas fa-user-graduate"></i>
                        <p>აირჩიეთ სტუდენტი შეფასების დასაწყებად.</p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-file-viewer-modal">
        <div class="modal file-viewer-modal" id="file-viewer-modal" role="dialog" aria-modal="true" aria-labelledby="file-viewer-title">
            <div class="modal-header">
                <h2 id="file-viewer-title"></h2>
                <div class="viewer-actions">
                    <a href="#" class="btn btn-secondary" id="file-download-btn" download>ჩამოტვირთვა</a>
                    <button class="close-modal-btn" data-action="close-modal" aria-label="ფაილის ხილვის დახურვა">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="file-viewer-container">
                    <iframe id="file-viewer-iframe" src="" frameborder="0" title="ფაილის ნახვა"></iframe>
                </div>
            </div>
        </div>
    </template>

    <template id="template-approve-retake-modal">
        <div class="modal" id="approve-retake-modal" role="dialog" aria-labelledby="approve-modal-title">
            <div class="modal-header">
                <h2 id="approve-modal-title">ხელახლა შესრულების დამტკიცება</h2>
                <button class="close-modal-btn" data-action="close-modal" aria-label="მოდალის დახურვა">&times;</button>
            </div>
            <form id="approve-retake-form">
                <div class="modal-body">
                    <p>დააყენეთ ახალი ვადა ამ სტუდენტისთვის. ეს გადააყენებს მათ გაგზავნას და ქულას, რაც საშუალებას მისცემს მათ ხელახლა გაგზავნონ.</p>
                    <div class="form-group">
                        <label for="retake-end-time">ახალი ვადა</label>
                        <input type="datetime-local" id="retake-end-time" name="newDueDate" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">გაუქმება</button>
                    <button type="submit" class="btn btn-primary">დამტკიცება</button>
                </div>
            </form>
        </div>
    </template>

    <div id="notification-container" aria-live="assertive" aria-atomic="true"></div>

    <script src="/header/header.js"></script>
    <script src="/assignments/assignments.js"></script>
</body>
</html>

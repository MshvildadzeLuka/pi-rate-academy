<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignments | Pi-Rate Academy</title>
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../header/header.css">
    <link rel="stylesheet" href="assignments.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <main class="assignments-container">
        <div class="assignments-main-header">
            <h1>Assignments</h1>
            <div class="header-actions" id="teacher-admin-controls" style="display: none;">
                <div class="form-group">
                    <select id="group-select" aria-label="Choose a Group"></select>
                </div>
                <button id="create-assignment-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Create Assignment
                </button>
            </div>
        </div>

        <nav class="tabs-nav" id="tabs-nav">
            </nav>

        <div class="content-area">
            <div id="assignment-list-view" class="view active">
                </div>

            <div id="assignment-detail-view" class="view">
                </div>
        </div>
    </main>

    <div id="modal-backdrop" class="modal-backdrop" style="display: none;">
        </div>


    <template id="template-create-assignment-modal">
        <div class="modal" id="create-assignment-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-header">
                <h2 id="modal-title">Create Assignment</h2>
                <button class="close-modal-btn" data-action="close-modal" aria-label="Close modal">&times;</button>
            </div>
            <form id="assignment-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="assignment-title">Title</label>
                        <input type="text" id="assignment-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="assignment-instructions">Instructions</label>
                        <textarea id="assignment-instructions" name="instructions" rows="5"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assignment-points">Points</label>
                            <input type="number" id="assignment-points" name="points" value="100" min="0">
                        </div>
                        <div class="form-group">
                            <label for="assignment-course">Group(s)</label>
                            <select id="assignment-course" name="courseId" required multiple></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="assignment-start-time">Start Time</label>
                            <input type="datetime-local" id="assignment-start-time" name="startTime" required>
                        </div>
                        <div class="form-group">
                            <label for="assignment-end-time">End Time</label>
                            <input type="datetime-local" id="assignment-end-time" name="endTime" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Attachments</label>
                        <div class="file-uploader" id="attachment-drop-zone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Drag & drop files here, or click to browse</p>
                            <input type="file" id="attachment-file-input" multiple hidden>
                        </div>
                        <div class="file-list" id="attachment-list"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Assignment</button>
                </div>
            </form>
        </div>
    </template>

    <template id="template-file-item">
        <div class="file-list-item">
            <i class="fas fa-file-alt file-icon"></i>
            <div class="file-info">
                <span class="file-name"></span>
                <div class="progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
            </div>
            <div class="file-status">
                </div>
            <button type="button" class="remove-file-btn" data-action="remove-file" aria-label="Remove file">&times;</button>
        </div>
    </template>

    <template id="template-student-detail-view">
        <div class="detail-panel">
            <div class="detail-panel-header">
                <button class="btn back-btn" data-action="back-to-list" aria-label="Back to assignments list"><i class="fas fa-arrow-left"></i> Back</button>
            </div>
            <div class="detail-content">
                <div class="assignment-main-content">
                    <h2 class="assignment-title-detail"></h2>
                    <div class="assignment-meta-detail">
                        <span>Due: <strong class="due-date"></strong></span>
                        <span>Points: <strong class="points"></strong></span>
                    </div>
                    <div class="instructions-container">
                        <h3>Instructions</h3>
                        <div class="instructions-text"></div>
                    </div>
                    <div class="attachments-container">
                        <h3>Teacher's Attachments</h3>
                        <div class="attachments-list"></div>
                    </div>
                    <div class="feedback-container" style="display: none;">
                        <h3>Feedback</h3>
                        <div class="feedback-box"></div>
                    </div>
                </div>
                <div class="submission-sidebar">
                    <div class="submission-box">
                        <h3>My Work</h3>
                        <div class="submission-status-box">
                            <span class="status-badge"></span>
                        </div>
                        <div class="file-list" id="submission-file-list"></div>
                        <div class="submission-actions">
                            <div class="file-uploader" id="submission-drop-zone" data-action="trigger-file-upload" data-target="submission-file-input">
                                <i class="fas fa-paperclip"></i>
                                <p>Add file</p>
                            </div>
                            <input type="file" id="submission-file-input" multiple hidden>
                            
                            <button class="btn btn-primary hand-in-btn" data-action="submit-assignment" disabled>Hand In</button>
                            <button class="btn btn-secondary unsubmit-btn" data-action="unsubmit-assignment" style="display: none;">Unsubmit</button>
                            <button class="btn btn-secondary request-retake-btn" data-action="request-retake" style="display: none;">Request Retake</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="template-teacher-detail-view">
         <div class="detail-panel-grading">
            <div class="detail-panel-header">
                 <button class="btn back-btn" data-action="back-to-list" aria-label="Back to assignments list"><i class="fas fa-arrow-left"></i> Back to List</button>
                 <h2 class="assignment-title-detail"></h2>
                 <button class="btn btn-secondary edit-master-btn" data-action="edit-assignment" aria-label="Edit master assignment"><i class="fas fa-edit"></i> Edit Assignment</button>
                 <!-- [NEW] Delete button for teachers and admins -->
                 <button class="btn btn-danger" data-action="delete-assignment" aria-label="Delete assignment"><i class="fas fa-trash"></i> Delete</button>
            </div>
            <div class="grading-layout">
                <div class="student-list-sidebar">
                    </div>
                <div class="grading-main-content">
                    <div class="grading-view-placeholder">
                        <i class="fas fa-user-graduate"></i>
                        <p>Select a student to begin grading.</p>
                    </div>
                    </div>
            </div>
        </div>
    </template>

    <template id="template-file-viewer-modal">
        <div class="modal file-viewer-modal" id="file-viewer-modal" role="dialog" aria-modal="true" aria-labelledby="file-viewer-title">
            <div class="modal-header">
                <h2 id="file-viewer-title"></h2>
                <div class="viewer-actions">
                    <a href="#" class="btn btn-secondary" id="file-download-btn" download>Download</a>
                    <button class="close-modal-btn" data-action="close-modal" aria-label="Close file viewer">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <iframe id="file-viewer-iframe" src="" frameborder="0" title="File Content Viewer"></iframe>
            </div>
        </div>
    </template>

    <template id="template-approve-retake-modal">
        <div class="modal" id="approve-retake-modal" role="dialog" aria-labelledby="approve-modal-title">
            <div class="modal-header">
                <h2 id="approve-modal-title">Approve Retake Request</h2>
                <button class="close-modal-btn" data-action="close-modal" aria-label="Close modal">&times;</button>
            </div>
            <form id="approve-retake-form">
                <div class="modal-body">
                    <p>Set a new due date for this student. This will reset their submission and grade, allowing them to submit again.</p>
                    <div class="form-group">
                        <label for="retake-end-time">New Due Date</label>
                        <input type="datetime-local" id="retake-end-time" name="newDueDate" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-action="close-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Confirm Approval</button>
                </div>
            </form>
        </div>
    </template>

    <div id="notification-container" aria-live="assertive" aria-atomic="true"></div>

    <script src="../header/header.js"></script>
    <script src="assignments.js"></script>
</body>
</html>